import type { User } from '@/payload-types'
import { cookies } from 'next/headers'
import { getAuthenticatedUser } from './auth'

export type UserLanguage = NonNullable<NonNullable<User['settings']>['language']>

const dictionaries: Record<UserLanguage, Record<string, any>> = {
  en: {
    common: {
      submittedBy: 'Submitted by',
      comments: 'comments',
      addComment: 'Add Comment',
      bookmark: 'Bookmark',
      bookmarked: 'bookmarked',
      postedBy: 'Posted by',
      commentAdded: 'Comment added!',
      failedToAddComment: 'Failed to add comment',
      loginToComment: 'Log in to comment',
    },
    menu: {
      home: 'Home',
      submitted: 'Submitted',
      newLink: 'New Link',
      login: 'Log in',
      signup: 'Sign up',
      logout: 'Log out',
      userMenu: 'User menu',
    },
    pages: {
      title: 'Approved Links',
      bookmarksOnly: 'Show Bookmarks Only',
      noBookmarks: 'No bookmarks found',
      noLinks: 'No links found',
      submittedTitle: 'All Submitted Links',
    },
    settings: {
      showNSFW: 'Show NSFW',
      language: 'Language',
      theme: 'Theme',
      nsfwEnabled: 'NSFW content enabled',
      nsfwDisabled: 'NSFW content disabled',
      updateError: 'Failed to update setting',
    },
    authForm: {
      emailOrUsername: 'Email or Username',
      password: 'Password',
      loginButton: 'Log In',
      signupButton: 'Sign Up',
      loginTitle: 'Login',
      loginDesc: 'Enter your credentials to access your account',
      loginRequired: 'Email or username is required',
      passwordRequired: 'Password is required',
      loggingIn: 'Logging in...',
      forgotPassword: 'Forgot password?',
      noAccount: "Don't have an account?",
      errorTitle: 'Error',
      genericError: 'Something went wrong',
      // Register
      createAccountTitle: 'Create Account',
      createAccountDesc: 'Sign up to get started',
      username: 'Username',
      usernameRequired: 'Username must be at least 2 characters',
      confirmPassword: 'Confirm Password',
      passwordMismatch: "Passwords don't match",
      createAccountButton: 'Create Account',
      creatingAccount: 'Creating account...',
      accountCreated: 'Account created successfully. Please login.',
      alreadyHaveAccount: 'Already have an account?',
      loginLink: 'Login',
      // Forgot Password
      forgotPasswordTitle: 'Forgot Password',
      forgotPasswordDesc: 'Enter your email to reset your password',
      sendResetLink: 'Send Reset Link',
      sending: 'Sending...',
      backToLogin: 'Back to Login',
      resetEmailSentTitle: 'Success',
      resetEmailSentDesc:
        'If an account exists with that email, we sent you a link to reset your password.',
      invalidEmail: 'Invalid email address',
      // Reset Password
      resetPasswordTitle: 'Reset Password',
      resetPasswordDesc: 'Enter your new password',
      newPassword: 'New Password',
      resetPasswordButton: 'Reset Password',
      resetting: 'Resetting...',
      resetSuccess: 'Password reset successfully. Please login.',
      missingToken: 'Missing reset token',
      invalidTokenTitle: 'Invalid Token',
      invalidTokenDesc: 'The password reset link is invalid or has expired.',
      requestNewLink: 'Request new reset link',
    },
    linkForm: {
      title: 'Submit a new link',
      titleLabel: 'Title',
      titlePlaceholder: 'Title of the link',
      titleDesc: 'This is the title of the link.',
      titleRequired: 'Title must be at least 2 characters.',
      urlLabel: 'URL',
      urlPlaceholder: 'https://example.com',
      urlDesc: 'The URL of the link.',
      urlInvalid: 'Please enter a valid URL.',
      descLabel: 'Description',
      descPlaceholder: 'A brief description of the link',
      descDesc: 'Optional: A brief description to give more context about the link.',
      typeLabel: 'Type',
      typePlaceholder: 'Link type',
      typeDesc: 'Optional: Specify the type of content (e.g., article, video).',
      nsfwLabel: 'NSFW',
      nsfwDesc: 'Check if the link contains Not Safe For Work content.',
      submitButton: 'Submit',
      submitting: 'Submitting...',
      submitSuccess: 'Link submitted successfully!',
      submitError: 'Failed to submit link. Please try again.',
      types: {
        article: 'Article',
        video: 'Video',
        image: 'Image',
        audio: 'Audio',
        game: 'Game',
      },
    },
    status: {
      published: 'Published',
      draft: 'Pending',
      unknown: 'Unknown',
    },
  },
  sv: {
    common: {
      submittedBy: 'Inskickat av',
      comments: 'kommentarer',
      addComment: 'Lägg till kommentar',
      bookmark: 'Bokmärk',
      bookmarked: 'bokmärkt',
      postedBy: 'Postad av',
      commentAdded: 'Kommentar tillagd!',
      failedToAddComment: 'Kunde inte lägga till kommentar',
      loginToComment: 'Logga in för att kommentera',
    },
    menu: {
      home: 'Hem',
      submitted: 'Inskickat',
      newLink: 'Ny Länk',
      login: 'Logga in',
      signup: 'Registrera',
      logout: 'Logga ut',
      userMenu: 'Användarmeny',
    },
    pages: {
      title: 'Godkända Länkar',
      bookmarksOnly: 'Visa endast bokmärken',
      noBookmarks: 'Inga bokmärken hittades',
      noLinks: 'Inga länkar hittades',
      submittedTitle: 'Alla inskickade länkar',
    },
    settings: {
      showNSFW: 'Visa NSFW',
      language: 'Språk',
      theme: 'Tema',
      nsfwEnabled: 'NSFW-innehåll aktiverat',
      nsfwDisabled: 'NSFW-innehåll inaktiverat',
      updateError: 'Kunde inte uppdatera inställning',
    },
    status: {
      published: 'Publicerad',
      draft: 'Väntande',
      unknown: 'Okänd',
    },
    authForm: {
      emailOrUsername: 'E-post eller Användarnamn',
      password: 'Lösenord',
      loginButton: 'Logga In',
      signupButton: 'Registrera',
      loginTitle: 'Logga In',
      loginDesc: 'Ange dina uppgifter för att logga in',
      loginRequired: 'E-post eller användarnamn krävs',
      passwordRequired: 'Lösenord krävs',
      loggingIn: 'Loggar in...',
      forgotPassword: 'Glömt lösenord?',
      noAccount: 'Har du inget konto?',
      errorTitle: 'Fel',
      genericError: 'Något gick fel',
      // Register
      createAccountTitle: 'Skapa konto',
      createAccountDesc: 'Registrera dig för att komma igång',
      username: 'Användarnamn',
      usernameRequired: 'Användarnamnet måste vara minst 2 tecken',
      confirmPassword: 'Bekräfta lösenord',
      passwordMismatch: 'Lösenorden matchar inte',
      createAccountButton: 'Skapa konto',
      creatingAccount: 'Skapar konto...',
      accountCreated: 'Konto skapat. Vänligen logga in.',
      alreadyHaveAccount: 'Har du redan ett konto?',
      loginLink: 'Logga in',
      // Forgot Password
      forgotPasswordTitle: 'Glömt lösenord',
      forgotPasswordDesc: 'Ange din e-post för att återställa lösenordet',
      sendResetLink: 'Skicka återställningslänk',
      sending: 'Skickar...',
      backToLogin: 'Tillbaka till inloggning',
      resetEmailSentTitle: 'Klart',
      resetEmailSentDesc:
        'Om ett konto finns med den e-postadressen har vi skickat en länk för att återställa lösenordet.',
      invalidEmail: 'Ogiltig e-postadress',
      // Reset Password
      resetPasswordTitle: 'Återställ lösenord',
      resetPasswordDesc: 'Ange ditt nya lösenord',
      newPassword: 'Nytt lösenord',
      resetPasswordButton: 'Återställ lösenord',
      resetting: 'Återställer...',
      resetSuccess: 'Lösenordet har återställts. Vänligen logga in.',
      missingToken: 'Återställningstoken saknas',
      invalidTokenTitle: 'Ogiltig token',
      invalidTokenDesc: 'Länken för återställning av lösenord är ogiltig eller har gått ut.',
      requestNewLink: 'Begär ny återställningslänk',
    },
    linkForm: {
      title: 'Skicka in en ny länk',
      titleLabel: 'Titel',
      titlePlaceholder: 'Titel på länken',
      titleDesc: 'Detta är länktiteln.',
      titleRequired: 'Titeln måste vara minst 2 tecken.',
      urlLabel: 'URL',
      urlPlaceholder: 'https://example.com',
      urlDesc: 'Länkens URL.',
      urlInvalid: 'Ange en giltig URL.',
      descLabel: 'Beskrivning',
      descPlaceholder: 'En kort beskrivning av länken',
      descDesc: 'Valfritt: En kort beskrivning för att ge mer sammanhang.',
      typeLabel: 'Typ',
      typePlaceholder: 'Länktyp',
      typeDesc: 'Valfritt: Ange typ av innehåll (t.ex. artikel, video).',
      nsfwLabel: 'NSFW',
      nsfwDesc: 'Markera om länken innehåller innehåll som inte är säkert för arbete (NSFW).',
      submitButton: 'Skicka',
      submitting: 'Skickar...',
      submitSuccess: 'Länken skickades!',
      submitError: 'Kunde inte skicka länken. Försök igen.',
      types: {
        article: 'Artikel',
        video: 'Video',
        image: 'Bild',
        audio: 'Ljud',
        game: 'Spel',
      },
    },
  },
}

export const getDictionary = async () => {
  const { user } = await getAuthenticatedUser()
  const cookieStore = await cookies()

  const lang = user?.settings?.language || (cookieStore.get('lang')?.value as UserLanguage) || 'en'

  return {
    dict: dictionaries[lang] || dictionaries.en,
    lang,
  }
}
